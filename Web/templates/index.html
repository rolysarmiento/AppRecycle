<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Interfaz - Cama (Tailwind)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --facebook-blue: #1877F2;
            --alert-red: #dc3545;
        }

        .glass {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            backdrop-filter: blur(8px);
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-[var(--facebook-blue)] via-blue-900 to-[var(--alert-red)] text-white flex items-center justify-center p-1">

    <main class="w-full max-w-6xl">


        <!-- <section class="bg-white/10 glass rounded-3xl p-8 shadow-2xl"> -->

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
            <aside class="md:col-span-1 flex flex-col gap-6">
                <div class="p-4 rounded-2xl bg-white/5 glass border border-white/10">
                    <h2 class="text-white font-semibold">Resultados :</h2>
                    <div id="resultado" class="mt-2 text-white/80"></div>
                </div>
                <div class="p-4 rounded-2xl bg-white/5 glass border border-white/10">
                    <h3 class="text-white font-medium mb-2">Controles</h3>
                    <div class="flex flex-col gap-3">
                        <button onclick="modelo(1)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Lenet
                        </button>
                        <button onclick="modelo(2)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Alexnet
                        </button>
                        <button onclick="modelo(3)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Resnet
                        </button>
                        <button onclick="modelo(4)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Inception
                        </button>
                        <button onclick="modelo(5)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Mobilenet
                        </button>
                        <button onclick="modelo(6)"
                            class="w-full py-2 rounded-xl bg-[var(--facebook-blue)] text-white font-semibold hover:scale-102 transition">
                            Modelo Efficientnet
                        </button>
                    </div>
                </div>
                <div class="p-4 rounded-2xl bg-white/5 glass border border-white/10">
                    <h3 class="text-white font-medium mb-2">Informaci√≥n</h3>
                    <ul class="text-white/70 text-sm space-y-2">
                        <li>üìè Dimensiones: 200 x 90 cm</li>
                        <li>üõå Tipo: King single</li>
                        <li>‚ö° Estado luz: <span id="estadoLuz">Apagada</span></li>
                    </ul>
                </div>
            </aside>



            <div class="md:col-span-2 flex flex-col items-center gap-4">
                <div
                    class="relative w-full max-w-4xl p-8 rounded-3xl bg-white/5 glass border border-white/10 shadow-lg">

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" id="tipoModelo" name="tipoModelo" value="1" />
                        <video id="videoCam" autoplay playsinline class="w-full flex justify-center">
                        </video>
                        <div class="flex items-center justify-between px-4 py-4">
                            <div>
                                <h2 class="text-white text-2xl font-bold">Cama central</h2>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" id="btnCamara" onclick="activar_camara()"
                                    class="py-2 px-4 rounded-full bg-[var(--facebook-blue)] text-white shadow hover:scale-105 transition">
                                    Activar Camara
                                </button>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" id="btnAnalizar" onclick="enviar_analizar()"
                                    class="py-2 px-4 rounded-full bg-[var(--facebook-blue)] text-white shadow hover:scale-105 transition">Activar
                                    Analizar</button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>



        </div>

        <!-- </section> -->


    </main>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        const btnCamara = document.getElementById('btnCamara');
        const video = document.getElementById('videoCam');

        function modelo(id_modelo) {
            alert(id_modelo);
            $('#tipoModelo').val(id_modelo);
        }


        async function activar_camara() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                video.srcObject = stream;
                btnCamara.textContent = "C√°mara activada";
                btnCamara.disabled = true;
                btnCamara.classList.add('opacity-70', 'cursor-not-allowed');
            } catch (err) {
                alert("No se pudo acceder a la c√°mara. Permisos denegados o no disponible.");
                console.error(err);
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function enviar_analizar() {
            const token = getCookie('csrftoken');
            const video = document.getElementById('videoCam');
            const canvas = document.createElement('canvas');
            const id_modelo = document.getElementById('tipoModelo').value;
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imagenBase64 = canvas.toDataURL('image/jpeg');
            $.ajax({
                url: '/analizar/',
                method: 'POST',
                data: {
                    'csrfmiddlewaretoken': token,
                    'imagen': imagenBase64,
                    'id_modelo': id_modelo,
                },
                success: function (response) {
                    $('#resultado').text(response.resultado);
                },
                error: function (xhr, status, error) {
                    console.error('Error en la petici√≥n:', error);
                }
            });
        }
    </script>



</body>

</html>